---
title : "[JS] 무한스크롤"
excerpt: "유튜브 쇼츠, 인스타그램 릴스"

categories:
  - js
tags:
  - [JS, React, Next.js]

toc: true
toc_sticky: true

date: 2025-09-01
last_modified_at: 2025-09-01
---
<br>

## 무한스크롤 구현

> 일반적인 데이터 리스트를 보여주는 무한스크롤과는 약간의 차이를 주어 데이터의 처음과 끝에서도 스크롤이 가능하도록 구현이 필요했다.

유튜브 쇼츠, 인스타그램 릴스처럼 스크롤당 게시물 전환을 구현해야 했다. 다만 2개 이상의 데이터만 존재해도 무조건적인 스크롤이 필요했기에 백과 프론트 모두 적용이 불가피했다.

서버에서 받아오는 데이터의 경우 2개 이상의 데이터가 존재할 경우 previous, current, next 의 객체배열이 함께 내려와 무한스크롤처럼 보이도록 했다.

```jsx
  useEffect(() => {
    if (initialData) {
      const items = [...initialData.previous, initialData.current, ...initialData.next]
      setCurrentItems(items)
      setCurrentIndex(3)
    }
}, [initialData])
```

리스트 상 해당 데이터를 클릭 후 변경된 url에서 id값을 받아와 데이터를 호출하게 되는 흐름을 고려해 
초기 데이터를 받아와 최초 7개의 블록을 설정해 가운데(index 3)에 현재의 게시물이 보이도록 설정하였다.

모바일 디바이스 웹만을 이용해 접근이 가능한 웹사이트 특성으로 각기 상이한 디바이스의 크기에 맞추어 화면에 꽉찬 렌더링을 위해 아이템의 높이와 위치를 계산해야 했다.
하지만 해당 과정에서 게시물이 먼저 보인 후 계산된 화면에 알맞게 조정되는 과정이 UX를 해쳐 수정이 필요했다.

```js
const updateItemMeasurements = useCallback(() => {
  const heights: number[] = []
  const positions: number[] = []
  let currentPosition = 0

  itemRefs.current.forEach((ref, index) => {
    const height = ref?.offsetHeight || window.innerHeight
    heights[index] = height
    positions[index] = currentPosition
    currentPosition += height
  })

  setItemHeights(heights)
  setItemPositions(positions)

  // 초기 렌더링 시 애니메이션 없이 즉시 이동
  if (isInitialRender && positions[3] !== undefined && containerRef.current) {
    containerRef.current.style.transition = 'none'
    containerRef.current.style.transform = `translateY(-${positions[3]}px)`

    // 다음 프레임에서 transition 복구 및 초기 상태 해제
    requestAnimationFrame(() => {
      if (containerRef.current) {
        containerRef.current.style.transition = 'transform 0.3s ease-out'
      }
      setIsInitialRender(false)
    })
  }
}, [isInitialRender])

useEffect(() => {
  if (currentItems.length > 0) {
    requestAnimationFrame(() => {
      updateItemMeasurements()
    })
  }
}, [currentItems, updateItemMeasurements])
```